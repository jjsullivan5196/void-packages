# Template file for 'pinephone-utils'
pkgname=pinephone-utils
version=0.1
revision=1
archs="aarch64*"
create_wrksrc=yes
depends="alsa-ucm-conf"
short_desc="Scripts/configs for managing pinephone hardware"
maintainer="John Sullivan <jsullivan@csumb.edu>"
license="MIT"
homepage="https://postmarketos.org/"

_commit_pmos=c48037d5ed307d865903ef3aecd302f1fa4417f8
_pmos_device='device/main/device-pine64-pinephone'
_pmos_checkout="pmaports-${_commit_pmos}-${_pmos_device//\//-}/${_pmos_device}"

distfiles="https://gitlab.com/postmarketOS/pmaports/-/archive/${_commit_pmos}/pmaports-${_commit_pmos}.tar.gz?path=${_pmos_device}>pmos-scripts-${version}.tar.gz"
checksum="d73200da438b6a5641ccd0e73f778cad07301c83b5bbf7286722c74a98675d2e"

do_patch() {
	patch "${_pmos_checkout}/90-modem-eg25.rules" -slNp1 -i "${PATCHESDIR}/vendor/modem-rules.patch"
	vsed -i 's/postmarketOS/void/' "${_pmos_checkout}/setup-modem.sh"
}

do_install() {
	vinstall "${_pmos_checkout}/90-modem-eg25.rules" 644 usr/lib/udev/rules.d
	vinstall "${_pmos_checkout}/00_alsa_pinephone_dshare.conf" 644 etc/alsa/conf.d "00-alsa-pinephone-dshare.conf"
	vbin "${_pmos_checkout}/setup-modem.sh" "pinephone_setup-modem"

	vmkdir usr/share/alsa/ucm2
	vcopy "${_pmos_checkout}/ucm" usr/share/alsa/ucm2/PinePhone

	vlicense "${FILESDIR}/COPYING"
}
